<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>검색 테스트</title>
<style>
body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; }
#map { width: 100%; height: 400px; border: 1px solid #ccc; }
.search-box { margin: 20px 0; }
.search-box input { padding: 10px; width: 300px; font-size: 16px; }
.search-box button { padding: 10px 20px; font-size: 16px; background: #1976D2; color: white; border: none; cursor: pointer; }
#results { margin-top: 10px; border: 1px solid #ddd; max-height: 300px; overflow-y: auto; }
.result-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
.result-item:hover { background: #f5f5f5; }
.result-name { font-weight: bold; }
.result-addr { color: #666; font-size: 14px; }
.result-cat { background: #e3f2fd; color: #1976D2; padding: 2px 6px; border-radius: 3px; font-size: 12px; margin-right: 5px; }
</style>
</head>
<body>
<h2>카카오맵 검색 테스트</h2>

<div class="search-box">
<input type="text" id="searchInput" placeholder="주소 또는 장소 검색 (예: 용민로 10)" />
<button onclick="doSearch()">검색</button>
</div>

<div id="results"></div>
<div id="map"></div>

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=7e60f6a42602329b925c66ea6db3bd87&libraries=services&autoload=false"></script>
<script>
var map;

kakao.maps.load(function() {
    var container = document.getElementById('map');
    map = new kakao.maps.Map(container, {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 5
    });
    console.log('지도 로드 완료');
});

function doSearch() {
    var query = document.getElementById('searchInput').value.trim();
    var resultsDiv = document.getElementById('results');
    
    if (query.length < 2) {
        resultsDiv.innerHTML = '<div class="result-item">2글자 이상 입력하세요</div>';
        return;
    }
    
    resultsDiv.innerHTML = '<div class="result-item">검색 중...</div>';
    
    var geocoder = new kakao.maps.services.Geocoder();
    var ps = new kakao.maps.services.Places();
    
    var allResults = [];
    var completed = 0;
    
    // 주소 검색
    geocoder.addressSearch(query, function(result, status) {
        console.log('주소 검색 결과:', status, result);
        if (status === kakao.maps.services.Status.OK) {
            result.slice(0, 5).forEach(function(r) {
                allResults.push({
                    name: r.address_name,
                    address: r.road_address ? r.road_address.address_name : '',
                    lat: r.y,
                    lng: r.x,
                    category: '주소'
                });
            });
        }
        completed++;
        if (completed === 2) showResults();
    });
    
    // 장소 검색
    ps.keywordSearch(query, function(result, status) {
        console.log('장소 검색 결과:', status, result);
        if (status === kakao.maps.services.Status.OK) {
            result.slice(0, 5).forEach(function(r) {
                allResults.push({
                    name: r.place_name,
                    address: r.road_address_name || r.address_name,
                    lat: r.y,
                    lng: r.x,
                    category: r.category_group_name || '장소'
                });
            });
        }
        completed++;
        if (completed === 2) showResults();
    });
    
    function showResults() {
        if (allResults.length === 0) {
            resultsDiv.innerHTML = '<div class="result-item">검색 결과가 없습니다</div>';
            return;
        }
        
        var html = '';
        allResults.forEach(function(r, i) {
            html += '<div class="result-item" onclick="goTo(' + r.lat + ',' + r.lng + ')">';
            html += '<div class="result-name"><span class="result-cat">' + r.category + '</span>' + r.name + '</div>';
            html += '<div class="result-addr">' + r.address + '</div>';
            html += '</div>';
        });
        resultsDiv.innerHTML = html;
    }
}

function goTo(lat, lng) {
    map.setCenter(new kakao.maps.LatLng(lat, lng));
    map.setLevel(3);
    
    new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng),
        map: map
    });
}

// 엔터키로 검색
document.getElementById('searchInput').addEventListener('keyup', function(e) {
    if (e.key === 'Enter') doSearch();
});
</script>
</body>
</html>